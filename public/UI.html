<!--
Copyright (C) 2014 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE html>
<html> 
  <head>
    <title>SMART TV</title>
    <link rel="stylesheet" type="text/css" href="css/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="css/UI.css">
    <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/components/icon.min.css'>
    <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/4.1.2/firebase.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script src="js/semantic.min.js"></script>
    <script src="js/chromecast.js"></script>
    <script src="js/youtube.js"></script>
    
    
    <script>
      // Initialize Firebase
      var config = {
          apiKey: "AIzaSyDUlvlNAiXxQalOc2gi_lLugC1QQ8BX3hc",
          authDomain: "nthusmarttv-d20c4.firebaseapp.com",
          databaseURL: "https://nthusmarttv-d20c4.firebaseio.com",
          projectId: "nthusmarttv-d20c4",
          storageBucket: "nthusmarttv-d20c4.appspot.com",
          messagingSenderId: "340586254788"
      };
      firebase.initializeApp(config);
    </script>
    
    <script src="js/client.js"> </script>

    <script type="text/javascript" src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

    <script>
        $(document).ready(function(){
          
          $(".youList").click(function(){   
                $('.ui.basic.modal')
                  .modal('show')
                ;
         }); 

         $('.special.cards .image').dimmer({
            on: 'hover'
          });

          $('.ui.dropdown')
            .dropdown()
          ;

        }); 
    </script>

  </head>
  <body>
      
     <div id='controller-panel'>
          
          <div class="ui  icon top right pointing dropdown inverted blue button" >
 
              <i class="thumbs outline up icon"></i>     

            <div class="menu">
              <div class="item" onclick="sendExpression('103087087', 'Angry')">
                 <i class="em em-angry"></i>
                Anger
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Disgust')">
                 <i class="em em-poop"></i>
                Disgust
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Fear')">
                 <i class="em em-confounded"></i>
                Fear
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Happiness')"> 
                  <i class="em em-blush"></i>
                Happiness
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Sadness')">
                  <i class="em em-cry"></i>
                Sadness
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Surprise')">
                 <i class="em em-open_mouth"></i>
                Surprise
              </div>
              <div class="item" onclick="sendExpression('103087087', 'Neutral')">
                 <i class="em em-neutral_face"></i>
                Neutral
              </div>
            </div>
          </div>
      
          <div class="ui animated inverted button olive " tabindex="0" onclick="sendMessage('playVideo')">
            <div class="visible content">Play</div>
            <div class="hidden content">
              <i class="play icon"></i>
            </div>
          </div>
          
          <div class="ui animated inverted button red " tabindex="0" onclick="sendMessage('pauseVideo')">
            <div class="visible content">Pause</div>
            <div class="hidden content">
              <i class="pause icon"></i>
            </div>
          </div>

          <div class="ui animated inverted button  basic" tabindex="0" onclick="sendMessage('playnext')">
            <div class="visible content">Next</div>
            <div class="hidden content">
              <i class="right arrow icon"></i>
            </div>
          </div>

          <div class="ui animated inverted button  basic" tabindex="0" onclick="sendMessage('playprev')">
            <div class="visible content">Back</div>
            <div class="hidden content">
              <i class="left arrow icon"></i>
            </div>
          </div>

           <div class="ui animated inverted button brown" tabindex="0" onclick="sendMessage('volumeUp')">
            <div class="visible content">Louder</div>
            <div class="hidden content">
              <i class="em em-loudspeaker"></i>
            </div>
          </div>   
       
       
        <div class="ui toggle checkbox" id='controller-checkbox'>
          <input type="checkbox" name="public">
          <label style="color:white;">Controller Mode</label>
        </div>
    </div>


    
        <div align="right" class="transparent messages" id="chatResults"></div> <!--chatWork-->
       
        <div id="wrapper" class="container">
           <div id="player"></div>
        </div>
        
        <div class="ui special cards dude six stackable link">
           
              <div class="red card" id="gaze1" >

                   <div class="blurring dimmable image">
                      <div class="ui inverted dimmer">
                        <div class="content">
                          <div class="center">
                            <div class="ui secondary button">Talk to her</div>
                          </div>
                        </div>
                      </div>
                      <img src="/image/suzy.jpg">
                  </div>

                  <div class="content">
                        <a class="header" >Suzy</a>
                        <div class="meta">
                          <span class="date" id="UserID">Expression</span>
                        </div>
                  </div>

                  <div class="extra content ui input">
                      <input type="text" placeholder="Say something..." id="103087087" style="visibility: hidden" onkeydown="sendChat('103087087',this.value)"/>
                  </div>
                  <div class="setGaze area" ><!--gazeWork-->
                    <div id="103087087_g1" align="center" style="visibility: hidden" onclick="sendGaze('103087087',true)"><strong><font color=#99ff66 face="verdana">Watching</font></strong></div>
                    <div id="103087087_g2" align="center" style="visibility: hidden" onclick="sendGaze('103087087',false)"><strong><font color=#ff3333 face="verdana">notWatching</font></strong></div>
                  </div>
              </div>

              <div class="red card" id="gaze2">

                   <div class="blurring dimmable image">
                      <div class="ui dimmer">
                        <div class="content">
                          <div class="center">
                            <div class="ui inverted button">Talk to her</div>
                          </div>
                        </div>
                      </div>
                      <img src="/image/IU.jpg">
                  </div>

                  <div class="content">
                        <a class="header" >IU</a>
                        <div class="meta">
                          <span class="date" id="UserID2">Expression</span>
                        </div>
                  </div>

                  <div class="extra content ui input">
                      <input type="text" placeholder="Say something..." id="103123123" onkeydown="sendChat('103123123',this.value)"/>
                  </div>
                  <div class="setGaze area" ><!--gazeWork-->
                    <div id="103123123_g1" align="center" onclick="sendGaze('103087087',true)"><strong><font color=#99ff66 face="verdana">Watching</font></strong></div>
                    <div id="103123123_g2" align="center" onclick="sendGaze('103087087',false)"><strong><font color=#ff3333 face="verdana">notWatching</font></strong></div>
                  </div>
                  <!--
                  <div class="ui animated inverted button blue" tabindex="0" >
                    <div class="visible content">Watching</div>
                  </div>
                  <div class="ui animated inverted button brown" tabindex="0" >
                    <div class="visible content">notWatching</div>
                  </div>-->
              </div>
       </div>


    <div class="ui basic modal">

        <div class="ui icon header">
            <i class="youtube play icon"></i> Youtube List
        </div>

        <div class="content">
            <p>Put Youtube List here, deciding which video to watch</p>
        </div>

        <div class="actions">

          <div class="ui red basic cancel inverted button">
              <i class="remove icon"></i>  No
          </div>

          <div class="ui green ok inverted button">
            <i class="checkmark icon"></i>   Yes
          </div>

        </div>
    </div>


    <script>
      var modeRef = firebase.database().ref('Mode');

      $('#controller-checkbox').checkbox().first().checkbox({
        onChange: function() {
        isController = !isController;
        console.log(isController);
        if(isController == true){
          document.getElementById('103123123').style.visibility = 'hidden';
          document.getElementById('103087087').style.visibility = 'visible';
          document.getElementById('103123123_g1').style.visibility = 'hidden';
          document.getElementById('103087087_g1').style.visibility = 'visible';
          document.getElementById('103123123_g2').style.visibility = 'hidden';
          document.getElementById('103087087_g2').style.visibility = 'visible';
          modeRef.set({userMode: 'controller'});
        }else{
          document.getElementById('103123123').style.visibility = 'visible';
          document.getElementById('103087087').style.visibility = 'hidden';
          document.getElementById('103123123_g1').style.visibility = 'visible';
          document.getElementById('103087087_g1').style.visibility = 'hidden';
          document.getElementById('103123123_g2').style.visibility = 'visible';
          document.getElementById('103087087_g2').style.visibility = 'hidden';
          modeRef.set({userMode: 'user'});
        }
        }
      });

      var exprRef = firebase.database().ref('User/103087087/Expression');
      var idRef = firebase.database().ref('User/103087087/ID');
      var gazeRef = firebase.database().ref('User/103087087/Gaze');

      var exprValue="777";
      var modeValue="123";

        // Input string 'ID', get the reference, then get its value, change its class to green or red 
        function gazeOn(gazeID){
          document.getElementById(gazeID).classList.remove('red');
          document.getElementById(gazeID).classList.add('green');
        }

        function gazeOff(gazeID){
          document.getElementById(gazeID).classList.remove('green');
          document.getElementById(gazeID).classList.add('red');
        }

        //GET mode
        modeRef.on('value', function(snapshot) { 
          snapshot.forEach(function(child) {
                modeValue = child.val();
                
          });
        });

        //GET Gaze
        gazeRef.on('value', function(snapshot) { 
          snapshot.forEach(function(child) {
          console.log(child.key, child.val());
          gazeValue = child.val();

          console.log('modeValue: '+modeValue);
          if(modeValue=='controller'){
            if(gazeValue==true){
              gazeOn('gaze1');
            }
            if(gazeValue==false){
                gazeOff('gaze1');
            }
          }else{
            if(gazeValue==true){
              gazeOn('gaze2');
            }
            if(gazeValue==false){
                gazeOff('gaze2');
            }
          }
          

          });
        });

        // GET Expression
        exprRef.on('value', function(snapshot) { 
          snapshot.forEach(function(child) {
          console.log(child.key, child.val());

          exprValue = child.val();

            
          if(exprValue=='Angry'){
            
            if(modeValue=='controller'){
              document.getElementById('UserID').innerHTML = '<i class="em em-angry"></i> Anger';
            }else{
              document.getElementById('UserID2').innerHTML = '<i class="em em-angry"></i> Anger';
            }
              
          }
          if(exprValue=='Happiness'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = ' <i class="em em-blush"></i> Happiness';
            else
              document.getElementById('UserID2').innerHTML = ' <i class="em em-blush"></i> Happiness';
          }

          if(exprValue=='Disgust'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = ' <i class="em em-poop"></i> Disgust';
            else
              document.getElementById('UserID2').innerHTML = ' <i class="em em-poop"></i> Disgust';
          }

          if(exprValue=='Fear'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = ' <i class="em em-confounded"></i> Fear';
            else
              document.getElementById('UserID2').innerHTML = ' <i class="em em-confounded"></i> Fear';
          }

          if(exprValue=='Sadness'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = '<i class="em em-cry"></i> Sadness';
            else
              document.getElementById('UserID2').innerHTML = '<i class="em em-cry"></i> Sadness';
          }

          if(exprValue=='Surprise'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = '<i class="em em-open_mouth"></i> Surprise';
            else
              document.getElementById('UserID2').innerHTML = '<i class="em em-open_mouth"></i> Surprise';
          }

          if(exprValue=='Neutral'){
            if(modeValue=='controller')
              document.getElementById('UserID').innerHTML = '<i class="em em-neutral_face"></i> Neutral';
            else
              document.getElementById('UserID2').innerHTML = '<i class="em em-neutral_face"></i> Neutral';
          }

          });
       });
  
      var messages = $(".messages");

      //chatWork
      var startListening = function() {
          
            firebase.database().ref('ChatLog/103087087').on('child_added', function(snapshot) {
            var msg = snapshot.val();
            console.log("msg:"+msg.chat);

            var msgUsernameElement = document.createElement("b");
            msgUsernameElement.textContent = 'Suzy';
            
            var msgTextElement = document.createElement("p");
            msgTextElement.textContent = msg.chat;
            
            var msgElement = document.createElement("div");
            msgElement.appendChild(msgUsernameElement);
            msgElement.appendChild(msgTextElement);

            msgElement.className = "msg";
            document.getElementById("chatResults").appendChild(msgElement);
            messages.scrollTop(messages.prop('scrollHeight'));
          });

            firebase.database().ref('ChatLog/103123123').on('child_added', function(snapshot) {
            var msg = snapshot.val();
            console.log("msg:"+msg.chat);
            var msgUsernameElement = document.createElement("b");
            msgUsernameElement.textContent = 'IU';
            
            var msgTextElement = document.createElement("p");
            msgTextElement.textContent = msg.chat;
      
            var msgElement = document.createElement("div");
            msgElement.appendChild(msgUsernameElement);
            msgElement.appendChild(msgTextElement);

            msgElement.className = "msg";
            document.getElementById("chatResults").appendChild(msgElement);
            messages.scrollTop(messages.prop('scrollHeight'));
          });
          

      }
      
      //chatWork, Begin listening for data
      startListening();

       /*
        gazeRef.on('value', function(snapshot) { 
          snapshot.forEach(function(child) {
            console.log(child.key, child.val());
            gazeValue = child.val();
          if(gazeValue=='true'){
              document.getElementById('gaze').classList.remove('red');
              document.getElementById('gaze').classList.add('green');
          }
          if(gazeValue=='false'){
              document.getElementById('gaze').classList.remove('green');
              document.getElementById('gaze').classList.add('red');
          }

          });
       }); 
       */
      
    </script>

  </body>


</html>
